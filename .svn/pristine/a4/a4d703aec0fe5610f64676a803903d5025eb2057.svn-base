using System.Data;

namespace Metro_Rail_DAL.DAL.Accounts.Transaction
{
    public class T13004DAL:CommonDAL
    {
        public DataTable GetVoucherList(string center, string fromDate, string toDate)
        {
            DataTable sql = new DataTable();
            var condition = "";
            if (center == "0")
            { condition = $" CONVERT(date, VOUCHER_DATE ,104) BETWEEN CONVERT(date, '{fromDate}' ,104) AND CONVERT(date, '{toDate}' ,104)"; }
            else { condition = $" T12005.CENTER_CODE='{center}' AND CONVERT(date, VOUCHER_DATE ,104) BETWEEN CONVERT(date, '{fromDate}' ,104) AND CONVERT(date, '{toDate}' ,104)"; }

            sql = Query($"SELECT ROW_NUMBER() OVER (ORDER BY  CAST(VOUCHER_NO as int) DESC) SL_NO, VOUCHER_NO, VOUCHER_DATE, T12005.CENTER_NAME, T12005.CENTER_CODE, T12006.VAUCHER_TYPE_NAME, T12006.VAUCHER_TYPE_CODE, T12007.TRANSACTION_TYPE_NAME, T12007.TRANSACTION_TYPE_CODE,T12007.TRANSACTION_TYPE_CODE, T12008.PARTY_TYPE_NAME,T12008.PARTY_TYPE_CODE, T12009.PARTY_NAME , T12009.PARTY_CODE,TOTAL_DEBIT,TOTAL_CREDIT, CASE  WHEN VERIFY_FLG IS NULL OR VERIFY_FLG='' THEN '0' ELSE '1' END AS VERIFY_FLG,CASE  WHEN POSTING_FLG IS NULL OR POSTING_FLG='' THEN '0' ELSE '1' END AS POSTING_FLG,AT13001.ENTRY_USER,T11020.T_USER_NAME FROM AT13001 JOIN T12005 ON AT13001.CENTER_CODE =T12005.CENTER_CODE JOIN T12006 ON AT13001.VAUCHER_TYPE_CODE =T12006.VAUCHER_TYPE_CODE JOIN T12007 ON AT13001.TRANSACTION_TYPE_CODE =T12007.TRANSACTION_TYPE_CODE JOIN T12008 ON AT13001.PARTY_TYPE_CODE =T12008.PARTY_TYPE_CODE JOIN T12009 ON AT13001.PARTY_CODE =T12009.PARTY_CODE JOIN T11020 ON AT13001.ENTRY_USER =T11020.T_USER_ID WHERE {condition} ORDER BY CAST(VOUCHER_NO as int) DESC");
            return sql;
        }
        public DataTable GetReportVoucherList(string center, string fromDate, string toDate)
        {
            DataTable sql = new DataTable();
            var condition = "";
            if (center == "0")
            { condition = $" CONVERT(date, VOUCHER_DATE ,104) BETWEEN CONVERT(date, '{fromDate}' ,104) AND CONVERT(date, '{toDate}' ,104)"; }
            else { condition = $" T12005.CENTER_CODE='{center}' AND CONVERT(date, VOUCHER_DATE ,104) BETWEEN CONVERT(date, '{fromDate}' ,104) AND CONVERT(date, '{toDate}' ,104)"; }

            sql = Query($"SELECT ROW_NUMBER() OVER (ORDER BY  CAST(VOUCHER_NO as int) DESC) SL_NO, VOUCHER_NO, VOUCHER_DATE, T12005.CENTER_NAME, T12005.CENTER_CODE, T12006.VAUCHER_TYPE_NAME, T12006.VAUCHER_TYPE_CODE, T12007.TRANSACTION_TYPE_NAME, T12007.TRANSACTION_TYPE_CODE,T12007.TRANSACTION_TYPE_CODE, T12008.PARTY_TYPE_NAME,T12008.PARTY_TYPE_CODE, T12009.PARTY_NAME , T12009.PARTY_CODE,CAST(TOTAL_DEBIT as decimal) TOTAL_DEBIT,CAST(TOTAL_CREDIT as decimal) TOTAL_CREDIT, CASE  WHEN VERIFY_FLG IS NULL OR VERIFY_FLG='' THEN '0' ELSE '1' END AS VERIFY_FLG,CASE  WHEN POSTING_FLG IS NULL OR POSTING_FLG='' THEN '0' ELSE '1' END AS POSTING_FLG,AT13001.ENTRY_USER,T11020.T_USER_NAME FROM AT13001 JOIN T12005 ON AT13001.CENTER_CODE =T12005.CENTER_CODE JOIN T12006 ON AT13001.VAUCHER_TYPE_CODE =T12006.VAUCHER_TYPE_CODE JOIN T12007 ON AT13001.TRANSACTION_TYPE_CODE =T12007.TRANSACTION_TYPE_CODE JOIN T12008 ON AT13001.PARTY_TYPE_CODE =T12008.PARTY_TYPE_CODE JOIN T12009 ON AT13001.PARTY_CODE =T12009.PARTY_CODE JOIN T11020 ON AT13001.ENTRY_USER =T11020.T_USER_ID WHERE {condition} ORDER BY CAST(VOUCHER_NO as int) DESC");
            return sql;
        }
        public DataTable ReportVoucherSingle(string voucherNo)
        {
            DataTable sql = new DataTable();
            sql = Query($"SELECT AT13001.VOUCHER_NO, VOUCHER_DATE, AT13001.CENTER_CODE, T12005.CENTER_NAME, AT13001.VAUCHER_TYPE_CODE, T12006.VAUCHER_TYPE_NAME, AT13001.TRANSACTION_TYPE_CODE, T12007.TRANSACTION_TYPE_NAME, AT13001.PARTY_TYPE_CODE , T12008.PARTY_TYPE_NAME,CONCAT (dbo.fnNumberToWords(TOTAL_DEBIT),' Only') IN_WORD, TOTAL_DEBIT , TOTAL_CREDIT , VERIFY_FLG , VERIFY_DATE , POSTING_FLG , POSTING_DATE , POSTING_USER , AT13001.PARTY_CODE,T12009.PARTY_NAME, AT13002.ACCOUNT_HEADER_CODE , T12010.ACCOUNT_HEADER_NAME , AT13002.DEPARTMENT_CODE , T12011.DEPARTMENT_NAME, AT13002.PURPOSE_CODE , T12010.ACCOUNT_ECONO_CODE, T12012.PURPOSE_NAME, AT13002.VOU_DESCRIPTION , AT13002.DEBIT , AT13002.CREDIT FROM AT13001 JOIN AT13002 ON AT13001.VOUCHER_NO =AT13002.VOUCHER_NO JOIN T12005 ON AT13001.CENTER_CODE =T12005.CENTER_CODE JOIN T12006 ON AT13001.VAUCHER_TYPE_CODE =T12006.VAUCHER_TYPE_CODE JOIN T12007 ON AT13001.TRANSACTION_TYPE_CODE =T12007.TRANSACTION_TYPE_CODE JOIN T12008 ON AT13001.PARTY_TYPE_CODE =T12008.PARTY_TYPE_CODE JOIN T12009 ON AT13001.PARTY_CODE =T12009.PARTY_CODE JOIN T12010 ON AT13002.ACCOUNT_HEADER_CODE =T12010.ACCOUNT_HEADER_CODE JOIN T12011 ON AT13002.DEPARTMENT_CODE =T12011.DEPARTMENT_CODE JOIN T12012 ON AT13002.PURPOSE_CODE =T12012.PURPOSE_CODE WHERE AT13001.VOUCHER_NO ='{voucherNo}'");
            return sql;
        }
    }
}
