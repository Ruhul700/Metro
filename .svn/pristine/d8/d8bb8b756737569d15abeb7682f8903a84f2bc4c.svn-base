
app.controller("T13006Controller", ["$scope", "Service", "Data", "$window", "$filter",
    function ($scope, Service, Data, $window, $filter) { //$location,
        $scope.obj = {};
        $scope.obj = Data;
        $scope.obj.T13006 = {};
        $scope.Param = {};
        $scope.obj.VERIFY_ALL = '0';
        getBudget();
        getActHeader();
        getDepartment();
        getPurpose();
        function getBudget() {
            var center = Service.loadDataWithoutParm('/T13001/GeProjectData');
            center.then(function (redata) {
                $scope.obj.ProjectList = JSON.parse(redata);
                $scope.obj.T13006.PAY_POINT = $scope.obj.ProjectList[0].T_PROJECT_NAME;
                $scope.obj.T13006.T_PROJECT_CODE = $scope.obj.ProjectList[0].T_PROJECT_CODE;
                $scope.obj.T13006.FISCAL_YEAR = '2025 - 2026';
                $scope.obj.T13006.PAYEE_TYPE = 'Supplier';
            });
        }
        function getActHeader() {
            var actHeader = Service.loadDataWithoutParm('/T13001/GetActHeaderData');
            actHeader.then(function (redata) {
                $scope.obj.ActHeaderList = JSON.parse(redata);
            });
        }
        function getDepartment() {
            var department = Service.loadDataWithoutParm('/T13001/GetDepartmentData');
            department.then(function (redata) {
                $scope.obj.DepartmentList = JSON.parse(redata);
            });
        }
        function getPurpose() {
            var purpose = Service.loadDataWithoutParm('/T13001/GetPurposeData');
            purpose.then(function (redata) {
                $scope.obj.PurposeList = JSON.parse(redata);
            });
        }
        //$scope.obj.T13002.FROM_DATE = new Date();
        //$scope.obj.T13002.TO_DATE = new Date();
        //var fromDate = $filter('date')($scope.obj.T13002.FROM_DATE, 'dd-MM-yyyy');
        //var toDate = $filter('date')($scope.obj.T13002.TO_DATE, 'dd-MM-yyyy');
        //getVoucherList('0', fromDate, toDate);
        //getCenter();
        //function getVoucherList(center, fromDate, toDate) {
        //    $scope.Param.CENTER = center;
        //    $scope.Param.FROM_DATE = fromDate;
        //    $scope.Param.TO_DATE = toDate;
        //    loader(true);
        //    var allvoucher = Service.loadDataListParm('/T13006/GetVoucherList', $scope.Param);
        //    allvoucher.then(function (redata) {
        //        $scope.obj.VoucherList = JSON.parse(redata);
        //        $scope.obj.TotalVoucher = $scope.obj.VoucherList.length;
        //        loader(false);
        //    });
        //}
        $scope.SearchSupplier = function () {
            $scope.T06 = {};
            var radioVal = $scope.obj.T13006.T_RADIO_VALUE;
            if (radioVal == undefined || radioVal == '') { showSMS('Please select one', 'warning'); return; }
            $scope.T06.T_RADIO_VALUE = radioVal;
            $scope.T06.T_SEARCH = $scope.obj.T13006.T_SEARCH;
            loader(true);
            var search = Service.loadDataSingleParm('/T13006/GetSearchValue', $scope.T06);
            search.then(function (success) {
                $scope.JsonData = JSON.parse(success);
                if ($scope.JsonData.length > 0) {
                    $scope.obj.T_SUPPLIER_ID = $scope.JsonData[0].T_SUPPLIER_ID;
                    $scope.obj.T_SUPPLIER_CODE = $scope.JsonData[0].T_SUPPLIER_CODE;
                    $scope.obj.T13006.T_SUPPLIER_NAME = $scope.JsonData[0].T_SUPPLIER_NAME;
                    $scope.obj.T_MOBILE_NO = $scope.JsonData[0].T_MOBILE_NO;
                    $scope.obj.T_ACCOUNT_NAME = $scope.JsonData[0].T_ACCOUNT_NAME;
                    $scope.obj.T_ACCOUNT_NO = $scope.JsonData[0].T_ACCOUNT_NO;
                    $scope.obj.T_BANK_NAME = $scope.JsonData[0].T_BANK_NAME;
                    $scope.obj.T_BRANCH = $scope.JsonData[0].T_BRANCH;
                    $scope.obj.T_SUPPLIER_TYPE = $scope.JsonData[0].T_SUPPLIER_TYPE;
                }
                   
                    loader(false)
                })
        }
        $scope.changeHeader = function (data) {
            $scope.obj.ACCOUNT_ECONO_CODE = data.ACCOUNT_ECONO_CODE;            
        }
        $scope.Add_Click = function () {
            if (isEmpty('txtProCode', 'lblProCode')) { return; };
            //if (isEmpty('txtBox')) { return; };
           // if (isEmpty('txtQuantity', 'lblQuantity')) { return; };
            var ckList = $scope.obj.dataList == undefined ? 0 : $scope.obj.dataList.filter(x => x.ACCOUNT_HEADER_CODE == $scope.obj.ACCOUNT_HEADER_CODE);
            if (ckList.length > 0) { showSMS('Already Exist !!', 'warning'); return; }
            var Newdatalist = [];
            var list = {};
            list.sl = 1;
            list.ACCOUNT_ECONO_CODE = $scope.obj.ACCOUNT_ECONO_CODE;
            //list.T_TYPE_NAME = $scope.obj.ddlType.T_TYPE_NAME;
           // list.T_TYPE_CODE = $scope.obj.ddlType.T_TYPE_CODE;
            list.ACCOUNT_HEADER_NAME = $scope.obj.ddlActHead.ACCOUNT_HEADER_NAME;
            list.ACCOUNT_HEADER_CODE = $scope.obj.ddlActHead.ACCOUNT_HEADER_CODE;
            list.DEPARTMENT_NAME = $scope.obj.ddlDepartment.DEPARTMENT_NAME;
            list.DEPARTMENT_CODE = $scope.obj.ddlDepartment.DEPARTMENT_CODE;
            list.PURPOSE_NAME = $scope.obj.ddlpurpuse.PURPOSE_NAME;
            list.PURPOSE_CODE = $scope.obj.ddlpurpuse.PURPOSE_CODE;
            list.DEBIT = $scope.obj.DEBIT == undefined ? 0 : $scope.obj.DEBIT == '' ? 0 : $scope.obj.DEBIT;
            list.CREDIT = $scope.obj.CREDIT == undefined ? 0 : $scope.obj.CREDIT == '' ? 0 : $scope.obj.CREDIT;
            Newdatalist.push(list);

            var ln = $scope.obj.dataList == undefined ? 0 : $scope.obj.dataList.length;
            for (var i = 0; i < ln; i++) {
                var list = {};
                list.sl = (i + 2);
                list.ACCOUNT_ECONO_CODE = $scope.obj.dataList[i].ACCOUNT_ECONO_CODE;
                //list.T_TYPE_NAME = $scope.obj.dataList[i].T_TYPE_NAME;
                //list.T_TYPE_CODE = $scope.obj.dataList[i].T_TYPE_CODE;
                list.ACCOUNT_HEADER_NAME = $scope.obj.dataList[i].ACCOUNT_HEADER_NAME;
                list.ACCOUNT_HEADER_CODE = $scope.obj.dataList[i].ACCOUNT_HEADER_CODE;
                list.DEPARTMENT_NAME = $scope.obj.dataList[i].DEPARTMENT_NAME;
                list.DEPARTMENT_CODE = $scope.obj.dataList[i].DEPARTMENT_CODE;
                list.PURPOSE_NAME = $scope.obj.dataList[i].PURPOSE_NAME;
                list.PURPOSE_CODE = $scope.obj.dataList[i].PURPOSE_CODE;
                list.DEBIT = $scope.obj.dataList[i].DEBIT;
                list.CREDIT = $scope.obj.dataList[i].CREDIT;               
                Newdatalist.push(list);
            }
            $scope.obj.dataList = Newdatalist;
            document.getElementById('txtProCode').focus();
            debit_Credit_Calculate();
           // salePriceCalculate(0, null);
            clearAddProduct();
        }
        function debit_Credit_Calculate() {
            var debittotal = 0;
            var credittotal = 0;
            for (var i = 0; i < $scope.obj.dataList.length; i++) {
                debittotal = parseFloat(debittotal) + parseFloat($scope.obj.dataList[i].DEBIT == '' ? '0' : $scope.obj.dataList[i].DEBIT)
                credittotal = parseFloat(credittotal) + parseFloat($scope.obj.dataList[i].CREDIT == '' ? '0' : $scope.obj.dataList[i].CREDIT)
            }
            $scope.obj.TOTAL_DEBIT = debittotal;
            $scope.obj.TOTAL_CREDIT = credittotal;
        }
        //function creditCalculate() {
        //    var credittotal = 0;
        //    for (var i = 0; i < $scope.obj.dataList.length; i++) {
        //        credittotal = parseFloat(credittotal) + parseFloat($scope.obj.dataList[i].CREDIT == '' ? '0' : $scope.obj.dataList[i].CREDIT)
        //    }
        //    $scope.obj.TOTAL_CREDIT = credittotal;
        //}
        $scope.Save_Click = function () {
            //loader(true)
            //var fromDate = $filter('date')($scope.obj.T13002.FROM_DATE, 'dd-MM-yyyy');
            //var toDate = $filter('date')($scope.obj.T13002.TO_DATE, 'dd-MM-yyyy');
            //var center = $scope.obj.ddlCenter == null ? '0' : $scope.obj.ddlCenter.CENTER_CODE;           
            //if ($scope.obj.VERIFY_ALL == '0') {
            //    $scope.Newlist = $scope.obj.VoucherList.filter(x => x.VERIFY_FLG == '1');
            //    var verify = Service.saveData('/T13002/VerifyedData', $scope.Newlist);
            //    verify.then(function (success) {
            //        smsAlert(success)
            //        getVoucherList(center, fromDate, toDate);
            //        loader(false)
            //    })
            //} else {
            //    var verify = Service.saveData('/T13002/VerifyedData', $scope.obj.VoucherList);
            //    verify.then(function (success) {
            //        smsAlert(success)
            //        getVoucherList(center, fromDate, toDate);
            //        loader(false)
            //    })
            //}
        }
        $scope.Clear_Click = function () {
            alert('Clear');
        }
        $scope.Print_Click = function () {
            alert('Print');
        }

    }
]);